<!DOCTYPE HTML>
<html>
	<head>
    	<title>socket.io client test</title>
        <link href="css/style.css" rel="stylesheet" type="text/css">
    	<script src="socket.io-client/socket.io.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>
		<script src="simplemodal.js"></script>
		<script type="text/javascript">			
			$(document).ready(function(){
				var username = null;

	      		var socket = new io.Socket(null, {port: 8080, rememberTransport: false});
	      		
				$(function(){
					socket.connect();
					$("#connecting_modal").modal({
					    opacity:50,
					    overlayCss: {backgroundColor:"#7f7f7f"},
					    overlayClose:true,
						position: ['20%', '40%']
					});
				});
				
	      		socket.on('message', function(obj){
		  			//console.log("Received: ");
					//console.log(obj);
					if(obj.opcode == 'suds_status')
					{
						//console.log(obj);
						var status_div = $('#suds-zones');
						status_div.html('');
						var table = $('<table></table>');
						for(var i in obj['status'])
						{
							//console.log(i);
							//console.log(obj['status'][i]);
							table.append('<tr><td id="'+i+'">' + i + '</td><td>' + obj['status'][i].toString() + '</td></tr>');
						}
						
						status_div.append(table);
					}
					else if(obj.opcode == 'update_stall')
					{

					}
	      		});

	      		socket.on('connect', function(){ 
					console.log("connected");
					//var send_connect = {'opcode': 'get_status'};
					//socket.send(send_connect);
					$.modal.close();
					
				});

	      		socket.on('disconnect', function(){ 
					console.log("disconnected");
					
					
				});

	      		socket.on('reconnect', function(){ 
					console.log("reconnected");
				});

	      		socket.on('reconnecting', function( nextRetry ){ 
					console.log("reconnecting");
				});

				socket.on('reconnect_failed', function(){ 
					console.log("failed to reconnect");
				});
			});
    	</script>
		
  	</head>
  	<body>
		<div id="suds-zones">
				
		</div>
		<div id="connecting_modal" class="modal">
		    <div class="modal-container">
		        <div class="modal-spinner clearboth" id="save-spinner">
		            <div class="spinner">
		                <img src="images/ajax-loader.gif">
		            </div>
		            <div class="loading-text">
		                Connecting...
		            </div>
		        </div>
		    </div>
		</div>
  </body>
</html>
